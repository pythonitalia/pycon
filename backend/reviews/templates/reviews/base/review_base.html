{% extends "admin/base_site.html" %}
{% load admin_urls static admin_list %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block extrahead %}
    {{ block.super }}
    <style>
        .review-score-options {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }

        .review-score-option {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .review-score-option:hover {
            border-color: #007cba;
        }

        .review-score-option.selected {
            background-color: #007cba;
            color: white;
            border-color: #005a87;
        }

        .review-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
            margin: 20px 0;
        }

        .review-main {
            background: white;
            padding: 20px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .review-sidebar {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .review-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-review {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .btn-primary {
            background-color: #007cba;
            color: white;
        }

        .btn-primary:hover {
            background-color: #005a87;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #545b62;
        }

        .review-summary {
            margin-bottom: 20px;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 4px;
            border-left: 4px solid #2196f3;
        }

        .review-navigation {
            margin-bottom: 20px;
        }

        .review-progress {
            margin-bottom: 10px;
            font-size: 14px;
            color: #666;
        }
    </style>
{% endblock %}

{% block content %}
<div id="content-main">
    {% block review_navigation %}
    <div class="review-navigation">
        <a href="{% url 'admin:reviews_reviewsession_change' review_session_id %}" class="btn btn-secondary">
            ‚Üê Back to Review Session
        </a>
        {% if can_review_items %}
        <a href="{% url 'admin:reviews-recap' review_session_id %}" class="btn btn-secondary">
            View Recap
        </a>
        {% endif %}
    </div>
    {% endblock %}

    {% block review_summary %}
    <div class="review-summary">
        <h2>{{ title }}</h2>
        <p><strong>Review Session:</strong> {{ review_session_repr }}</p>
        {% block additional_summary %}{% endblock %}
    </div>
    {% endblock %}

    {% block review_content %}
    <div class="review-content">
        <div class="review-main">
            {% block main_content %}{% endblock %}
        </div>

        <div class="review-sidebar">
            {% block sidebar_content %}{% endblock %}
        </div>
    </div>
    {% endblock %}

    {% block review_actions %}
    {% if can_review_items %}
    <form method="post" id="review-form">
        {% csrf_token %}
        {% block review_form %}{% endblock %}

        <div class="review-actions">
            {% block action_buttons %}
            <button type="submit" name="_next" class="btn-review btn-primary">
                Submit & Next
            </button>
            <button type="submit" name="_skip" class="btn-review btn-secondary">
                Skip
            </button>
            {% endblock %}
        </div>
    </form>
    {% endif %}
    {% endblock %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Score selection handling
    const scoreOptions = document.querySelectorAll('.review-score-option');
    scoreOptions.forEach(option => {
        option.addEventListener('click', function() {
            scoreOptions.forEach(opt => opt.classList.remove('selected'));
            this.classList.add('selected');
            const scoreInput = document.getElementById('id_score');
            if (scoreInput) {
                scoreInput.value = this.dataset.scoreId;
            }
        });
    });

    // Form validation
    const form = document.getElementById('review-form');
    if (form) {
        form.addEventListener('submit', function(e) {
            const scoreInput = document.getElementById('id_score');
            const submitNext = e.submitter && e.submitter.name === '_next';

            if (submitNext && scoreInput && !scoreInput.value) {
                e.preventDefault();
                alert('Please select a score before submitting.');
                return false;
            }
        });
    }
});
</script>
{% endblock %}