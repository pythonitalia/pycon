ARG FUNCTION_DIR="/home/app/"

FROM python:3.9

RUN apt update -y && apt install -y ffmpeg libsm6 libxext6

ARG FUNCTION_DIR

RUN mkdir -p ${FUNCTION_DIR}
WORKDIR ${FUNCTION_DIR}

RUN pip3 install poetry==1.3.2

COPY poetry.lock ${FUNCTION_DIR}
COPY pyproject.toml ${FUNCTION_DIR}

RUN mkdir -p ${FUNCTION_DIR}/assets

RUN poetry config virtualenvs.create false
RUN poetry install

COPY . ${FUNCTION_DIR}
